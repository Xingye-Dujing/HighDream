<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>CommonMatrixCalculator - 矩阵计算基类文档</title>
    <link rel="stylesheet" href="/static/help.css" />
  </head>
  <body>
    <div id="help-container">
      <ul class="header">
        <li>
          <a href="/">HighDream Notebook</a>
        </li>
        <li>
          <a href="/help">帮助文档</a>
        </li>
      </ul>

      <h1>
        <strong>CommonMatrixCalculator</strong>
        (core/common_matrix_calculator.py)
      </h1>

      <p>
        矩阵计算器的抽象基类，为各种矩阵运算提供统一的框架和基础功能。它封装了矩阵输入解析、步骤记录、结果显示等通用操作，简化了具体矩阵计算器的开发。
      </p>

      <div class="warning">
        <p>
          <strong>注意:</strong>&nbsp;&nbsp;
          出现的所有图中，箭头的方向无实际意义，上面的文字所指可能是前对后，也可能是后对前
        </p>
      </div>

      <h2 id="class-overview">一.&nbsp;&nbsp;类概述</h2>
      <p>CommonMatrixCalculator 为矩阵计算提供了一套完整的基础设施：</p>
      <ul>
        <li>
          <strong>步骤管理</strong>：通过 MatrixStepGenerator 记录计算过程
        </li>
        <li><strong>输入解析</strong>：支持多种格式的矩阵和向量输入</li>
        <li><strong>表达式简化</strong>：自动简化矩阵元素中的符号表达式</li>
        <li><strong>输出格式化</strong>：生成 LaTeX 格式的计算步骤</li>
      </ul>

      <p>它与其它类的关系如下：</p>
      <img src="/static/images/system_architecture_2.svg" />

      <h2 id="design-principles">二.&nbsp;&nbsp;设计原则</h2>
      <ul>
        <li>
          <strong>一致性</strong>：为所有矩阵计算器提供统一的接口和用户体验
        </li>
        <li><strong>灵活性</strong>：支持多种输入格式，适应不同的使用场景</li>
        <li>
          <strong>可扩展性</strong>：作为抽象基类，易于添加新的矩阵计算功能
        </li>
        <li><strong>教学友好</strong>：详细的步骤记录有助于理解矩阵计算过程</li>
      </ul>

      <h2 id="input-formats">
        三.&nbsp;&nbsp;输入格式 (parse_matrix_input 方法决定)
      </h2>

      <h3>1.&nbsp;&nbsp;矩阵输入格式</h3>
      <p><strong>嵌套列表格式:</strong> [[1, 2], [3, 4]] - 2×2 矩阵</p>
      <p><strong>逗号隔开的多列表格式:</strong> [1, 2], [3, 4] - 2×2 矩阵</p>

      <h3>2.&nbsp;&nbsp;向量输入格式</h3>
      <p><strong>列向量格式:</strong> [[1], [2], [3]] - 标准列向量格式</p>

      <p><strong>行向量格式:</strong> [1, 2, 3] - 程序将自动转换为列向量</p>

      <h2 id="attributes">四.&nbsp;&nbsp;属性</h2>
      <table class="parameter-table">
        <thead>
          <tr>
            <th>属性名</th>
            <th>类型</th>
            <th>描述</th>
            <th>访问级别</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>step_generator</td>
            <td>MatrixStepGenerator</td>
            <td>矩阵步骤生成器实例，负责管理计算步骤的记录和格式化输出</td>
            <td>公共</td>
          </tr>
        </tbody>
      </table>

      <div class="warning">
        <p>
          <strong>设计说明:</strong> step_generator 使用专门的
          MatrixStepGenerator 类来处理矩阵计算特有的步骤显示需求。与
          BaseStepGenerator 相比,
          主要差在矩阵计算不需要以连等式形式输出过程，且每步表达式与解释文本也不在同一行出现。
        </p>
      </div>

      <h2 id="methods">五.&nbsp;&nbsp;方法</h2>

      <h3>1.&nbsp;&nbsp;方法初始化方法</h3>

      <div class="method-signature">__init__(self) -> None</div>
      <p>初始化矩阵计算器实例，创建 MatrixStepGenerator 用于步骤管理。</p>
      <p><strong>执行效果:</strong> 创建 self.step_generator 实例</p>

      <h3>2.&nbsp;&nbsp;方法步骤记录方法</h3>

      <div class="method-signature">add_step(self, title: str) -> None</div>
      <p>向计算过程添加步骤标题，用于组织和描述计算流程。</p>
      <p><strong>参数:</strong></p>
      <table class="parameter-table">
        <thead>
          <tr>
            <th>参数名</th>
            <th>类型</th>
            <th>描述</th>
            <th>默认值</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>title</td>
            <td>str</td>
            <td>步骤的标题文本，将显示在计算过程中</td>
            <td><em>必需</em></td>
          </tr>
        </tbody>
      </table>

      <div class="method-signature">
        add_matrix(self, matrix: Matrix, name: str = "A") -> None
      </div>
      <p>向步骤管理器中添加矩阵及其标识符。</p>
      <p><strong>参数:</strong></p>
      <table class="parameter-table">
        <thead>
          <tr>
            <th>参数名</th>
            <th>类型</th>
            <th>描述</th>
            <th>默认值</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>matrix</td>
            <td>Matrix</td>
            <td>要显示的 SymPy 矩阵对象</td>
            <td><em>必需</em></td>
          </tr>
          <tr>
            <td>name</td>
            <td>str</td>
            <td>矩阵的标识符名称</td>
            <td>"A"</td>
          </tr>
        </tbody>
      </table>

      <div class="method-signature">
        add_vector(self, vector: Matrix, name: str = "x") -> None
      </div>
      <p>向步骤管理器中添加向量及其标识符。</p>
      <p><strong>参数:</strong></p>
      <table class="parameter-table">
        <thead>
          <tr>
            <th>参数名</th>
            <th>类型</th>
            <th>描述</th>
            <th>默认值</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>vector</td>
            <td>Matrix</td>
            <td>要显示的 SymPy 向量（列矩阵）</td>
            <td><em>必需</em></td>
          </tr>
          <tr>
            <td>name</td>
            <td>str</td>
            <td>向量的标识符名称</td>
            <td>"x"</td>
          </tr>
        </tbody>
      </table>

      <div class="method-signature">
        add_equation(self, equation: str) -> None
      </div>
      <p>向步骤管理器中添加方程或 LaTeX 文本。</p>
      <p><strong>参数:</strong></p>
      <table class="parameter-table">
        <thead>
          <tr>
            <th>参数名</th>
            <th>类型</th>
            <th>描述</th>
            <th>默认值</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>equation</td>
            <td>str</td>
            <td>方程的 LaTeX 表示形式</td>
            <td><em>必需</em></td>
          </tr>
        </tbody>
      </table>

      <h3>3.&nbsp;&nbsp;输出方法</h3>

      <div class="method-signature">get_steps_latex(self) -> str</div>
      <p>获取完整的计算步骤，以 LaTeX 格式返回。</p>
      <p><strong>返回值:</strong> str - 包含所有计算步骤的 LaTeX 代码</p>
      <p><strong>适用场景:</strong></p>
      <ul>
        <li>在网页中显示计算过程</li>
        <li>在 Jupyter notebook 中渲染</li>
      </ul>

      <h3>4.&nbsp;&nbsp;方法输入解析方法</h3>

      <div class="method-signature">
        parse_matrix_input(self, matrix_input: str) -> Matrix
      </div>
      <p>将矩阵字符串解析为 SymPy 的 Matrix 对象。</p>
      <p><strong>参数:</strong></p>
      <table class="parameter-table">
        <thead>
          <tr>
            <th>参数名</th>
            <th>类型</th>
            <th>描述</th>
            <th>默认值</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>matrix_input</td>
            <td>str</td>
            <td>矩阵的字符串表示</td>
            <td><em>必需</em></td>
          </tr>
        </tbody>
      </table>
      <p><strong>返回值:</strong> Matrix - 解析后的 SymPy 矩阵对象</p>
      <p>
        <strong>异常:</strong> ValueError - 当输入字符串无法解析为有效矩阵时
      </p>
      <div class="warning">
        <p>
          <strong>注意:</strong> 此方法使用 SymPy 的 sympify 函数，支持所有
          SymPy 认可的数字和符号表达式。
        </p>
      </div>

      <div class="method-signature">
        parse_vector_input(self, vector_input: str) -> Matrix
      </div>
      <p>将向量字符串解析为 SymPy 的 Matrix 对象（列向量）。</p>
      <p><strong>参数:</strong></p>
      <table class="parameter-table">
        <thead>
          <tr>
            <th>参数名</th>
            <th>类型</th>
            <th>描述</th>
            <th>默认值</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>vector_input</td>
            <td>str</td>
            <td>向量的字符串表示</td>
            <td><em>必需</em></td>
          </tr>
        </tbody>
      </table>
      <p><strong>返回值:</strong> Matrix - 解析后的 SymPy 列向量</p>
      <p>
        <strong>异常:</strong> ValueError - 当输入字符串无法解析为有效向量时
      </p>

      <h3>4.&nbsp;&nbsp;工具方法</h3>

      <div class="method-signature">
        simplify_matrix(self, matrix: Matrix) -> Matrix
      </div>
      <p>化简矩阵中的每个元素。</p>
      <p><strong>参数:</strong></p>
      <table class="parameter-table">
        <thead>
          <tr>
            <th>参数名</th>
            <th>类型</th>
            <th>描述</th>
            <th>默认值</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>matrix</td>
            <td>Matrix</td>
            <td>需要简化的 SymPy 矩阵</td>
            <td><em>必需</em></td>
          </tr>
        </tbody>
      </table>
      <p><strong>返回值:</strong> Matrix - 简化后的矩阵</p>
      <p><strong>特性:</strong></p>
      <ul>
        <li>对非零元素应用 SymPy 的 simplify 函数</li>
        <li>适用于包含符号表达式的矩阵</li>
      </ul>

      <h2 id="usage-examples">六.&nbsp;&nbsp;步骤记录指南</h2>
      <p>
        1.&nbsp;&nbsp;<strong>逻辑分组</strong>：使用 add_step() 将相关操作分组
      </p>
      <p>
        2.&nbsp;&nbsp;<strong>清晰标识</strong>：为矩阵和向量使用有意义的名称
      </p>
      <p>
        3.&nbsp;&nbsp;<strong>完整过程</strong>：记录从输入到输出的完整计算流程
      </p>
      <p>
        4.&nbsp;&nbsp;<strong>教学价值</strong>：添加解释性步骤帮助理解数学原理
      </p>

      <h2 id="error-handle">七.&nbsp;&nbsp;错误处理</h2>
      <p>1.&nbsp;&nbsp;<strong>不可逆</strong>：始终处理矩阵不可逆的情况</p>
      <p>2.&nbsp;&nbsp;<strong>维度不匹配</strong>：检查矩阵维度兼容性</p>
      <p>3.&nbsp;&nbsp;<strong>输入格式有误</strong>：验证输入格式的有效性</p>
      <p>
        4.&nbsp;&nbsp;<strong>简化报错</strong>：处理符号表达式可能出现的简化问题
      </p>
    </div>
  </body>
</html>
